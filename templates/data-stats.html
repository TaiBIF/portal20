{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}
è³‡æ–™ç™¼å¸ƒç‹€æ³
{% endblock %}
{% block head %}
<style>
  .axis {
      font: 16px sans-serif;
  }
  .axis path,
  .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
  }

svg text.label {
  fill: #846C5B;
  font-size: 15px;
  font-weight: 400;
  text-anchor: middle;
}

</style>
{% endblock %}

{% block script %}
{#<script src="https://d3js.org/d3.v3.min.js"></script>#}
<script src="{% static 'js/d3.min.js' %}"></script>
<script src="{% static 'js/analytics.js' %}"></script>

{% if env == "dev" %}
<script src="{% static 'js/dataset-table.js' %}"></script>
{% elif env == "prod" %}
<script src="{% static 'js/dataset-table.min.js' %}"></script>
{% endif %}

<script>
  const checkboxMOST = document.querySelector('.check-most');
  checkboxMOST.onclick = function(e){
    let baseURL = `${window.location.origin}${window.location.pathname}`;
    if (e.target.checked === true) {
      window.location.href =  `${baseURL}?most=1`
    }
    else {
      window.location.href = baseURL;
    }
  }
</script>
{% endblock %}

{% block main %}
{% include "inc_breadcrumb.html" with tab="01" active_label="è³‡æ–™ç™¼å¸ƒç‹€æ³" %}

<div class="container">
  <div class="row">
    <h1 class="heading-lg-ul">
      è³‡æ–™ç™¼å¸ƒç‹€æ³
      <span class="heading-footnote">å…¨éƒ¨</span>
    </h1>
    <div class="heading-sort-ctn">
      <label class="custom-input-ctn">
        <input type="checkbox" class="check-most"{% if request.GET.most %} checked{% endif %}>
        <span class="checkmark"></span>
        åƒ…æª¢è¦–ç§‘æŠ€éƒ¨ç™¼å¸ƒç‹€æ³
        (TaiBIF çš„è³‡æ–™åº«åŠåŸºç¤å»ºè¨­ä¹ƒç”±ç§‘æŠ€éƒ¨ä¹‹ç¶“è²»åŠç›¸é—œè¨ˆç•«æ”¯æŒï¼Œå‹¾é¸æ­¤é …å¯äº†è§£ç§‘æŠ€éƒ¨ç”Ÿç‰©å¤šæ¨£æ€§è¨ˆç•«ç‰©ç¨®è³‡æ–™é–‹æ”¾ç‹€æ³)
      </label>
    </div>


    <h3>çµ±æ•´æ•¸æ“š</h3>

    <div class="panel panel-default">
      <div class="panel-heading">ä»Šå¹´åº¦ä¸Šå‚³è³‡æ–™ç­†æ•¸</div>
      <div class="panel-body">
        <div id="taibif-stats__this_year_occurrence"></div>
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">ä»Šå¹´åº¦ä¸Šå‚³è³‡æ–™é›†æ•¸é‡</div>
      <div class="panel-body">
        <div id="taibif-stats__this_year_dataset"></div>
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">ç´¯ç©è³‡æ–™ç­†æ•¸</div>
      <div class="panel-body">
        <div id="taibif-stats__trend_occurrence"></div>
      </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading">ç´¯ç©è³‡æ–™é›†æ•¸é‡</div>
      <div class="panel-body">
        <div id="taibif-stats__trend_dataset"></div>
      </div>
    </div>

    <div id="dataset-table-container"></div>
    {% comment %}
    <hr>
    <h3>å·²ç™¼å¸ƒè³‡æ–™åˆ—è¡¨ <small><a href="{% url 'search-dataset' %}" class="btn btn-default"> ğŸ‘‰ æœå°‹è³‡æ–™é›†</a></small></h3> 
    <table class="table table-bordered">
      <thead>
        <tr><th width="20%">è³‡æ–™é›†åç¨±</th>
          <th width="%26">ç™¼å¸ƒå–®ä½</th>
          <th width="10%">è³‡æ–™é¡å‹</th>
          <th width="8%">è³‡æ–™ç­†æ•¸</th>
          <th width="8%">å‡ºç¾ç´€éŒ„</th>
          <th width="10%">ç™¼ä½ˆæ™‚é–“</th><
            th width="7%">åœ°å€</th>
            <th width="11%">å…¬é–‹ç‹€æ…‹</th></tr>
      </thead>
      {% for i in dataset_list %}
      <tr><td>{% if i.status == "PUBLIC" %}<a href="{{ i.get_absolute_url }}">{{ i.title }}</a>{% else %}{{ i.title }}{% endif%}</td>
        <td>{{ i.organization.name }}</td>
        <td>{{ i.get_dwc_core_type_display }}</td>
        <td>{{ i.num_record|intcomma }}</td>
        <td>{{ i.num_occurrence|intcomma }}</td>
        <td>{{ i.pub_date|date:'Y/m/d' }}</td>
        <td>{{ i.country_for_human }}</td>
        <td>{{ i.get_status_display }}{% if i.status == "PUBLIC" %}<br><small>{% if i.guid %}å·²è¨»å†Šè‡³ GBIF{% else %}æœªè¨»å†Šè‡³ GBIF{% endif %}</small>{% endif %}</td></tr>
      {% endfor %}
    </table>
    {% endcomment %}
  </div>
</div>
{% endblock %}

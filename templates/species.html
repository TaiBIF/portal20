{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block head %}
<link href="{% static 'css/taibif.css' %}" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/leaflet.css' %}">
<script src="{% static 'js/species-detail.js' %}"></script>
<script src="{% static 'js/leaflet.js' %}"></script>
<script src="{% static 'js/leaflet-heat.js' %}"></script>
    <style>
        #map { width: 800px; height: 600px; }
        body { font: 16px/1.4 "Helvetica Neue", Arial, sans-serif; }
        .ghbtns { position: relative; top: 4px; margin-left: 5px; }
        a { color: #0077ff; }
    </style>
{% endblock %}

{% block script %}
{% if map_view %}
{{ occurrence_list|json_script:"occurrence-points" }}

<script>

  const map = L.map('map').setView([{{ map_view.0 }}, {{ map_view.1 }}], 10);

  const tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
}).addTo(map);

  //addressPoints = addressPoints.map(function (p) { return [p[0], p[1]]; });
  const points = JSON.parse(document.getElementById('occurrence-points').textContent);
  const occurrencePoints = points.map(function (p) {
    return [p['decimallatitude'], p['decimallongitude']]
  });
  console.log(occurrencePoints);

const heat = L.heatLayer(occurrencePoints).addTo(map);

</script>
{% endif %}
{% endblock %}
{% block main %}
{# include "inc_breadcrumb.html" with tab="03" active_label="" #}
<!-- container begin -->
<div class="container">
  <h2>{{ taxon.scientific_name_infraspecific }} {% if not taxon.is_accepted_name %}<small><span class="label label-warning">同物異名</span></small>{% endif %}</h2>
    <p>
    來源: <a href="http://taicol.tw">臺灣物種名錄 (TaiCoL)</a> | 搜尋 TaiCol: <a href="{{ taxon.taicol_search_link }}" target/"_blank">{{ taxon.name }}</a>{% if taxon.taicol_namecode_link%} | name_code: <a href="{{ taxon.taicol_namecode_link}}">{{ taxon.source_id }}</a>{% endif %}
    </p>
    <div>{% if not taxon.is_accepted_name and taxon.accepted_species%}Accepted name: <a href="/species/{{taxon.accepted_species.id }}">{{ taxon.accepted_species.scientific_name_infraspecific }}</a>{% endif %}</div>
  <div class="article-head-wrapper">
    <h1 class="heading-lg-ul">
      分類
    </h1>
    <ul class="species-ranklist__container">
      {% for i in taxon.rank_list %}
      <li class="species-ranklist__item">
        <div class="species-ranklist__item-name">
          <a href="{{ i.get_absolute_url }}">{{ i.name }}</a>
        </div>
        <div class="species-ranklist__item-name-zh">
          {{ i.name_zh }}
        </div>
      </li>
      <li><div>→</div></li>
      {% endfor %}
      <span>{{ taxon.get_name }}</span>
    </ul>
    {% if taxon.children %}
    <div>
      <h4>{{ taxon.children.0.get_rank_display }} {{ taxon.children.0.rank }}</h4>
      <ul class="species-taxon-children__container">
      {% for i in taxon.children %}
      <li class="species-taxon-children__item"><a href="{{ i.get_absolute_url }}">{{ i.get_name }}</a></li>
      {% endfor %}
      </ul>
    </div>
    {% endif %}
    {#<p>物種數: </p>#}
  </div>

  {% if taxon.rank == "species" %}
  <div class="article-head-wrapper">
    <h1 class="heading-lg-ul">
      照片
    </h1>
    <div>來源: <a href="https://taieol.tw/pages/{{ species_info.taieol_taxon_id }}/media" target="_blank">臺灣生命大百科</a></div>
    {% for i in species_info.taieol_media %}
    {% if forloop.counter0|divisibleby:4 %}
    <div class="row">
    {% endif %}
    <div class="col-md-3 col-xs-6">
      <div class="thumbnail">
        <img src="{{ i.src}}">
        <div class="caption">
          <p> {{ i.author }}, {{ i.cc }}</p>
        </div>
      </div>
    </div>
    {% if forloop.counter|divisibleby:4 %}
    </div>
    {% endif %}
    {% endfor %}
  </div>
  {% endif %}
  <div class="article-head-wrapper">
    <h1 class="heading-lg-ul">
      出現紀錄
    </h1>
    <div id="map"></div>
    <ul>
      {% for i in occurrence_list %}
      <li>{{ i.scientificname }} - {{ i.taibif_dataset_name}}</li>
      {% endfor %}
    </ul>
  </div>

  出現資料集

</div>
  <!-- container end -->
{% endblock %}
